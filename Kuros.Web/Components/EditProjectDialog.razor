@using Kuros.Core.DTOs.Projects
@inject ApiClient ApiClient

<div class="dialog-content">
    <h3>Edit Project</h3>
    <EditForm Model="@updateModel" OnValidSubmit="@HandleUpdate">
        <DataAnnotationsValidator />

        <div class="form-group">
            <label for="name">Project Name</label>
            <InputText id="name" @bind-Value="updateModel.Name" class="form-control" />
        </div>

        <div class="form-group">
            <label for="description">Description (Optional)</label>
            <InputTextArea id="description" @bind-Value="updateModel.Description" class="form-control" rows="4"
                placeholder="Enter project description (optional)" />
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" @onclick="Cancel" disabled="@isSaving">Close</button>
            <button type="submit" class="btn btn-primary" disabled="@isSaving">
                @if (isSaving)
                {
                    <span>Updating...</span>
                }
                else
                {

                    <span>Update</span>
                }
            </button>
        </div>
    </EditForm>
</div>

@code {
    [Parameter] public ProjectResponseDto? Project { get; set; }

    private ProjectUpdateDto updateModel = new();
    private bool isSaving = false;

    [Parameter]
    public EventCallback OnClose { get; set; }

    [Parameter]
    public EventCallback<ProjectResponseDto> OnSuccess { get; set; }

    protected override void OnInitialized()
    {
        if (Project != null)
        {
            updateModel.Name = Project.Name;
            updateModel.Description = Project.Description;
        }
    }

    private async Task HandleUpdate()
    {
        if (Project == null) return;

        isSaving = true;

        var result = await ApiClient.UpdateProjectAsync(Project.Id, updateModel);

        if (result != null)
        {
            await OnSuccess.InvokeAsync(result);
        }

        isSaving = false;
        await OnClose.InvokeAsync();
    }

    private async Task Cancel()
    {
        await OnClose.InvokeAsync();
    }
}