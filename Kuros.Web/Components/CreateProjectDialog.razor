@namespace Kuros.Web.Components

@using Kuros.Core.DTOs.Projects
@inject ApiClient ApiClient

<div class="dialog-content">
    <h3>Create Project</h3>
    <EditForm Model="@createModel" OnValidSubmit="@HandleCreate">
        <DataAnnotationsValidator />

        <div class="form-group">
            <label for="name">Project Name</label>
            <InputText id="name" @bind-Value="createModel.Name" class="form-control" required />
        </div>

        <div class="form-group">
            <label for="description">Description (Optional)</label>
            <InputTextArea id="description" @bind-Value="createModel.Description" class="form-control" rows="4"
                placeholder="Enter project description (optional)" />
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" @onclick="Cancel" disabled="@isSaving">Close</button>
            <button type="submit" class="btn btn-primary" disabled="@isSaving">
                @if (isSaving)
                {
                    <span>Creating...</span>
                }
                else
                {

                    <span>Create</span>
                }
            </button>
        </div>
    </EditForm>
</div>

@code {
    private ProjectCreateDto createModel = new();
    private bool isSaving = false;

    [Parameter]
    public EventCallback OnClose { get; set; }

    [Parameter]
    public EventCallback<ProjectResponseDto> OnSuccess { get; set; }

    private async Task HandleCreate()
    {
        isSaving = true;

        var result = await ApiClient.CreateProjectAsync(createModel);

        if (result != null)
        {
            await OnSuccess.InvokeAsync(result);
        }

        isSaving = false;
        await OnClose.InvokeAsync();
    }

    private async Task Cancel()
    {
        await OnClose.InvokeAsync();
    }
}