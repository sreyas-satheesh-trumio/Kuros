@using Kuros.Core.DTOs.TaskItems
@inject ApiClient ApiClient

<div class="dialog-content">
    <h3>Create Task</h3>
    <EditForm Model="@createModel" OnValidSubmit="@HandleCreate">
        <DataAnnotationsValidator />

        <div class="form-group">
            <label for="title">Task Title</label>
            <InputText id="title" @bind-Value="createModel.Title" class="form-control" required
                placeholder="Enter task title" />
            <br>
            <label for="description">Task Description</label>
            <InputTextArea id="description" @bind-Value="createModel.Description" class="form-control" rows="4"
                placeholder="Enter task description (optional)" />
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" @onclick="Cancel" disabled="@isSaving">Close</button>
            <button type="submit" class="btn btn-primary" disabled="@isSaving">
                @if (isSaving)
                {
                    <span>Creating...</span>
                }
                else
                {
                    <span>Create</span>
                }
            </button>
        </div>
    </EditForm>
</div>

@code {
    [Parameter] public Guid ProjectId { get; set; }

    private TaskItemCreateDto createModel = new();
    private bool isSaving = false;

    [Parameter]
    public EventCallback OnClose { get; set; }

    [Parameter]
    public EventCallback<TaskItemResponseDto> OnSuccess { get; set; }

    protected override void OnInitialized()
    {
        createModel.ProjectId = ProjectId;
    }

    private async Task HandleCreate()
    {
        isSaving = true;

        var result = await ApiClient.CreateTaskAsync(createModel);

        if (result != null)
        {
            await OnSuccess.InvokeAsync(result);
        }

        isSaving = false;
        await OnClose.InvokeAsync();
    }

    private async Task Cancel()
    {
        await OnClose.InvokeAsync();
    }
}